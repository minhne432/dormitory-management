<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/manager/layout}">

<head>
    <title layout:fragment="title">Room List</title>
</head>

<body>
<div layout:fragment="content">
    <div class="container mt-4">
        <h1 class="text-2xl font-bold mb-4">Room List</h1>

        <!-- Form lọc (GET method) -->
        <form th:action="@{/rooms/list}" method="get" id="filterForm" class="row g-3 p-3 bg-white shadow-sm rounded">
            <div class="col-md-3 mb-3">
                <label for="roomNumber" class="form-label">Room Number:</label>
                <input type="text" id="roomNumber" name="roomNumber" th:value="${filter.roomNumber}" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
                <label for="dormName" class="form-label">Dorm Name:</label>
                <input type="text" id="dormName" name="dormName" th:value="${filter.dormName}" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
                <label for="maxCapacity" class="form-label">Max Capacity:</label>
                <input type="number" id="maxCapacity" name="maxCapacity" th:value="${filter.maxCapacity}" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
                <label for="gender" class="form-label">Gender:</label>
                <select id="gender" name="gender" class="form-select">
                    <option th:value="null" th:text="'--All--'"></option>
                    <option th:value="Nam" th:text="'Nam'" th:selected="${filter.gender != null and filter.gender == 'Nam'}"></option>
                    <option th:value="Nữ" th:text="'Nữ'" th:selected="${filter.gender != null and filter.gender == 'Nữ'}"></option>
                </select>
            </div>
            <div class="col-md-3 mb-3">
                <label for="price" class="form-label">Price:</label>
                <input type="number" step="0.01" id="price" name="price" th:value="${filter.price}" class="form-control"/>
            </div>
            <div class="col-md-3 mb-3">
                <label for="status" class="form-label">Status:</label>
                <select id="status" name="status" class="form-select">
                    <option th:value="null" th:text="'--All--'"></option>
                    <option th:value="available" th:text="'available'" th:selected="${filter.status == 'available'}"></option>
                    <option th:value="full" th:text="'full'" th:selected="${filter.status == 'full'}"></option>
                    <option th:value="maintenance" th:text="'maintenance'" th:selected="${filter.status == 'maintenance'}"></option>
                </select>
            </div>

            <div class="col-12">
                <button type="submit" class="btn btn-primary">Filter</button>
            </div>
        </form>

        <hr class="my-4"/>

        <!-- Bảng danh sách phòng -->
        <table class="table table-bordered">
            <thead class="table-dark">
            <tr>
                <th>Room ID</th>
                <th>Room Number</th>
                <th>Dorm Name</th>
                <th>Max Capacity</th>
                <th>Gender</th>
                <th>Price</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="room : ${rooms}">
                <td th:text="${room.roomId}"></td>
                <td th:text="${room.roomNumber}"></td>
                <td th:text="${room.dormitory.dormName}"></td>
                <td th:text="${room.roomType.maxCapacity}"></td>
                <td th:text="${room.roomType.gender}"></td>
                <td th:text="${room.roomType.price}"></td>
                <td th:text="${room.status}"></td>
                <td>
                    <a th:href="@{'/rooms/edit/' + ${room.roomId}}"
                       class="btn btn-warning btn-sm">Edit</a>
                </td>
            </tr>
            </tbody>
        </table>

    </div>
</div>

<!-- Script localStorage -->
<script layout:fragment="script">
    // Khi trang load, lấy giá trị filter từ localStorage (nếu có) và gán vào form
    document.addEventListener("DOMContentLoaded", function () {
        let filterKeys = ["roomNumber", "dormName", "maxCapacity", "gender", "price", "status"];

        // Đọc từng trường từ localStorage, set vào form
        filterKeys.forEach(key => {
            let savedValue = localStorage.getItem(key);
            if (savedValue !== null) {
                let element = document.getElementById(key);
                if (element) {
                    element.value = savedValue;
                }
            }
        });

        // Bắt sự kiện SUBMIT, lưu giá trị filter vào localStorage
        document.getElementById("filterForm").addEventListener("submit", function() {
            filterKeys.forEach(key => {
                let element = document.getElementById(key);
                if (element) {
                    localStorage.setItem(key, element.value);
                }
            });
        });
    });
</script>
</body>
</html>
