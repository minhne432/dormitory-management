<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/manager/layout}">
<head>
    <title layout:fragment="title">Room Service Usage Chart</title>
</head>
<body>
<div layout:fragment="content" class="mx-auto mt-4 max-w-6xl">
    <h1 class="mb-4">Room Service Usage Chart</h1>
    <p>From: <span th:text="${startDate}"></span> To: <span th:text="${endDate}"></span></p>
    <canvas id="usageChart" width="1000" height="600"></canvas>
</div>


<script th:inline="javascript" layout:fragment="script">
    /*<![CDATA[*/
    var chartData = /*[[${chartData}]]*/ '[]';
    chartData = JSON.parse(JSON.stringify(chartData));
    console.log(chartData);
    var labelsSet = new Set();
    var dataByService = {};

    chartData.forEach(function(item) {
        labelsSet.add(item.date);
        if (!dataByService[item.serviceName]) {
            dataByService[item.serviceName] = {};
        }
        dataByService[item.serviceName][item.date] = item.usageCount;
    });
    var labels = Array.from(labelsSet).sort();
    console.log("Labels: ", labels);

    var datasets = [];
    console.log("Datasets: ", datasets);

    // Ví dụ định nghĩa màu sắc cho từng dịch vụ (có thể tùy chỉnh)
    var colors = {
        "Điện": "rgba(255, 99, 132, 1)",
        "Nước": "rgba(75, 192, 192, 1)"
    };

    Object.keys(dataByService).forEach(function(serviceName) {
        var dataArray = [];
        labels.forEach(function(date) {
            dataArray.push(dataByService[serviceName][date] || 0);
        });
        datasets.push({
            label: serviceName,
            data: dataArray,
            fill: false,
            borderColor: colors[serviceName] || 'rgba(0,0,0,1)',
            tension: 0.1
        });
    });

    var ctx = document.getElementById('usageChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: datasets
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Date' } },
                y: { title: { display: true, text: 'Usage' }, beginAtZero: true }
            }
        }
    });
    /*]]>*/
</script>
</body>
</html>
