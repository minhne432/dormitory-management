<!-- sidebar.html -->
<nav layout:fragment="sidebar" id="sidebar"
     class="bg-gray-800 text-white w-64 min-h-screen transition-all duration-300 ease-in-out overflow-hidden p-4">

    <!-- Header Sidebar -->
    <div class="flex justify-between items-center">
        <h1 id="sidebarTitle" class="text-xl font-bold transition-all duration-300">Trang Sinh Vi√™n</h1>
        <button id="toggleBtn" class="text-white focus:outline-none">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>
    </div>

    <!-- Th√¥ng b√°o -->
    <a th:href="@{/notifications/student/{studentId}(studentId=${session.student?.studentId})}"
       class="flex items-center justify-between bg-white p-2 rounded shadow my-4 hover:bg-gray-50">
        <span class="text-gray-700 sidebar-text">Th√¥ng b√°o</span>
        <div id="notificationBadge"
             class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center">0
        </div>
    </a>

    <hr class="my-4 border-gray-300">

    <!-- Danh s√°ch menu -->
    <ul class="space-y-2">
        <li>
            <a th:href="@{/student/home}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">üè†</span>
                <span class="ml-3 sidebar-text">Trang ch·ªß</span>
            </a>
        </li>
        <li>
            <a th:href="@{/register-dormitory}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">üè¢</span>
                <span class="ml-3 sidebar-text">ƒêƒÉng k√Ω ·ªü KTX</span>
            </a>
        </li>
        <li>
            <a th:href="@{/student/services}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">üîß</span>
                <span class="ml-3 sidebar-text">D·ªãch v·ª•</span>
            </a>
        </li>
        <li>
            <a th:href="@{/bills/filter}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">üí≥</span>
                <span class="ml-3 sidebar-text">H√≥a ƒë∆°n</span>
            </a>
        </li>
        <li>
            <a th:href="@{/profile}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">üë§</span>
                <span class="ml-3 sidebar-text">H·ªì s∆° c√° nh√¢n</span>
            </a>
        </li>
        <li>
            <a th:href="@{/settings}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">‚öôÔ∏è</span>
                <span class="ml-3 sidebar-text">C√†i ƒë·∫∑t</span>
            </a>
        </li>
        <li>
            <a th:href="@{/help}" class="flex items-center p-2 rounded hover:bg-gray-700">
                <span class="w-6 h-6 flex items-center justify-center">‚ùì</span>
                <span class="ml-3 sidebar-text">Tr·ª£ gi√∫p</span>
            </a>
        </li>
    </ul>

    <hr class="my-4 border-gray-300">

    <!-- Dropdown user -->
    <div class="relative mt-4">
        <button id="dropdownButton" class="flex items-center w-full p-2 rounded hover:bg-gray-700 focus:outline-none">
            <img src="https://via.placeholder.com/32" alt="User avatar" class="w-8 h-8 rounded-full">
            <span class="ml-3 sidebar-text">User</span>
            <svg class="ml-auto w-4 h-4 transition-transform duration-200 sidebar-icon" fill="currentColor"
                 viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                      d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 011.08 1.04l-4.25 4.25a.75.75 0 01-1.08 0L5.25 8.27a.75.75 0 01-.02-1.06z"
                      clip-rule="evenodd"/>
            </svg>
        </button>
        <ul class="absolute left-0 right-0 mt-2 bg-white border border-gray-200 rounded shadow-lg hidden"
            id="dropdownMenu">
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">H·ªì s∆°</a></li>
            <li><a href="#" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">C√†i ƒë·∫∑t</a></li>
            <li><hr class="my-1 border-gray-200"></li>
            <li>
                <form th:action="@{/logout}" method="post">
                    <button type="submit"
                            class="w-full text-left px-4 py-2 text-gray-700 hover:bg-gray-100">
                        ƒêƒÉng xu·∫•t
                    </button>
                </form>
            </li>
        </ul>
    </div>
    <!-- Script x·ª≠ l√Ω Sidebar -->
    <script>
        const sidebar = document.getElementById('sidebar');
        const sidebarText = document.querySelectorAll('.sidebar-text');
        const sidebarTitle = document.getElementById('sidebarTitle');
        const toggleBtn = document.getElementById('toggleBtn');

        toggleBtn.addEventListener('click', () => {
            sidebar.classList.toggle('w-64');
            sidebar.classList.toggle('w-16');
            sidebarTitle.classList.toggle('hidden');
            sidebarText.forEach(text => text.classList.toggle('hidden'));
        });
    </script>

    <!-- Script x·ª≠ l√Ω Dropdown -->
    <script>
        document.getElementById('dropdownButton').addEventListener('click', function() {
            const menu = document.getElementById('dropdownMenu');
            menu.classList.toggle('hidden');
        });
    </script>

    <!-- Script c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng th√¥ng b√°o -->
    <script>
        function pollNotifications() {
            fetch('/notifications/poll?studentId=4')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('notificationBadge').innerText = data.length;
                })
                .catch(error => console.error('L·ªói khi polling th√¥ng b√°o:', error));
        }
        setInterval(pollNotifications, 3000);
        pollNotifications();
    </script>

</nav>

